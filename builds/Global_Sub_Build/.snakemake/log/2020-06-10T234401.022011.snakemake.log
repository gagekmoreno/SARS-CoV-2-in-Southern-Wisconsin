Building DAG of jobs...
Using shell: /bin/bash
Provided cores: 1 (use --cores to define parallelism)
Rules claiming more threads will be scaled down.
Job counts:
	count	jobs
	1	adjust_metadata
	1	aggregate_alignments
	1	all
	1	ancestral
	1	clades
	1	colors
	1	export
	1	filter
	1	fix_colorings
	1	incorporate_travel_history
	1	mask
	1	partition_sequences
	1	recency
	1	refine
	1	subsample
	1	tip_frequencies
	1	traits
	1	translate
	1	tree
	19

[Wed Jun 10 23:44:02 2020]
Job 19: 
        Filtering to
          - excluding strains in config/exclude.txt
          - minimum genome length of 25000
        


        augur filter             --sequences data/sequences.fasta             --metadata data/metadata.tsv             --include config/include.txt             --exclude config/exclude.txt             --exclude-where date='2020' date='2020-01-XX' date='2020-02-XX' date='2020-03-XX' date='2020-04-XX' date='2020-01' date='2020-02' date='2020-03' date='2020-04'            --min-length 25000             --group-by division year month             --sequences-per-group 4             --output results/filtered.fasta
        
[Wed Jun 10 23:44:22 2020]
Finished job 19.
1 of 19 steps (5%) done

[Wed Jun 10 23:44:22 2020]
checkpoint partition_sequences:
    input: results/filtered.fasta
    output: results/split_sequences/pre/
    jobid: 18
Downstream jobs will be updated after completion.


        python3 scripts/partition-sequences.py             --sequences results/filtered.fasta             --sequences-per-group 150             --output-dir results/split_sequences/pre/
        
Updating job 17 (aggregate_alignments).
[Wed Jun 10 23:44:24 2020]
Finished job 18.
2 of 25 steps (8%) done

[Wed Jun 10 23:44:24 2020]
rule adjust_metadata:
    input: data/metadata.tsv
    output: results/metadata_adjusted.tsv
    jobid: 5
    wildcards: region=


        cp data/metadata.tsv results/metadata_adjusted.tsv
        
[Wed Jun 10 23:44:26 2020]
Finished job 5.
3 of 25 steps (12%) done

[Wed Jun 10 23:44:26 2020]
Job 7: Constructing colors file


        python3 scripts/assign-colors.py             --ordering config/ordering.tsv             --color-schemes config/color_schemes.tsv             --output config/colors.tsv             --metadata results/metadata_adjusted.tsv
        
[Wed Jun 10 23:44:31 2020]
Finished job 7.
4 of 25 steps (16%) done

[Wed Jun 10 23:44:31 2020]
Job 15: Use metadata on submission date to construct submission recency field


        python3 scripts/construct-recency-from-submission-date.py             --metadata results/metadata_adjusted.tsv             --output results/recency.json
        
[Wed Jun 10 23:44:47 2020]
Finished job 15.
5 of 25 steps (20%) done

[Wed Jun 10 23:44:48 2020]
Job 24: 
        partitions_intermediate: Copying sequence fastas
        0
        

cp results/split_sequences/pre/0.fasta results/split_sequences/post/0.fasta
[Wed Jun 10 23:44:48 2020]
Finished job 24.
6 of 25 steps (24%) done

[Wed Jun 10 23:44:48 2020]
Job 21: 
        Aligning sequences to config/reference.gb
          - gaps relative to reference are considered real
        Cluster:  0
        


        augur align             --sequences results/split_sequences/post/0.fasta             --reference-sequence config/reference.gb             --output results/split_alignments/0.fasta             --nthreads 1             --remove-reference             --fill-gaps
        
[Wed Jun 10 23:45:44 2020]
Finished job 21.
7 of 25 steps (28%) done

[Wed Jun 10 23:45:44 2020]
Job 25: 
        partitions_intermediate: Copying sequence fastas
        1
        

cp results/split_sequences/pre/1.fasta results/split_sequences/post/1.fasta
[Wed Jun 10 23:45:45 2020]
Finished job 25.
8 of 25 steps (32%) done

[Wed Jun 10 23:45:45 2020]
Job 22: 
        Aligning sequences to config/reference.gb
          - gaps relative to reference are considered real
        Cluster:  1
        


        augur align             --sequences results/split_sequences/post/1.fasta             --reference-sequence config/reference.gb             --output results/split_alignments/1.fasta             --nthreads 1             --remove-reference             --fill-gaps
        
[Wed Jun 10 23:46:30 2020]
Finished job 22.
9 of 25 steps (36%) done

[Wed Jun 10 23:46:30 2020]
Job 26: 
        partitions_intermediate: Copying sequence fastas
        2
        

cp results/split_sequences/pre/2.fasta results/split_sequences/post/2.fasta
[Wed Jun 10 23:46:31 2020]
Finished job 26.
10 of 25 steps (40%) done

[Wed Jun 10 23:46:31 2020]
Job 23: 
        Aligning sequences to config/reference.gb
          - gaps relative to reference are considered real
        Cluster:  2
        


        augur align             --sequences results/split_sequences/post/2.fasta             --reference-sequence config/reference.gb             --output results/split_alignments/2.fasta             --nthreads 1             --remove-reference             --fill-gaps
        
[Wed Jun 10 23:47:16 2020]
Finished job 23.
11 of 25 steps (44%) done

[Wed Jun 10 23:47:16 2020]
Job 20: Collecting alignments


        cat results/split_alignments/0.fasta results/split_alignments/1.fasta results/split_alignments/2.fasta > results/aligned.fasta
        
[Wed Jun 10 23:47:17 2020]
Finished job 20.
12 of 25 steps (48%) done

[Wed Jun 10 23:47:17 2020]
Job 9: 
        Mask bases in alignment
          - masking 130 from beginning
          - masking 50 from end
          - masking other sites: 18529 29849 29851 29853
        


        python3 scripts/mask-alignment.py             --alignment results/aligned.fasta             --mask-from-beginning 130             --mask-from-end 50             --mask-sites 18529 29849 29851 29853             --output results/masked.fasta
        
[Wed Jun 10 23:47:18 2020]
Finished job 9.
13 of 25 steps (52%) done

[Wed Jun 10 23:47:18 2020]
rule subsample:
    input: results/masked.fasta
    output: results/subsampled_alignment.fasta
    jobid: 16
    wildcards: region=


        cp results/masked.fasta results/subsampled_alignment.fasta
        
[Wed Jun 10 23:47:21 2020]
Finished job 16.
14 of 25 steps (56%) done

[Wed Jun 10 23:47:21 2020]
Job 8: Building tree


        augur tree             --alignment results/subsampled_alignment.fasta             --output results/tree_raw.nwk             --nthreads 1
        
[Wed Jun 10 23:47:43 2020]
Finished job 8.
15 of 25 steps (60%) done

[Wed Jun 10 23:47:43 2020]
Job 4: 
        Refining tree
          - estimate timetree
          - use skyline coalescent timescale
          - estimate marginal node dates
        


        augur refine             --tree results/tree_raw.nwk             --alignment results/masked.fasta             --metadata results/metadata_adjusted.tsv             --output-tree results/tree.nwk             --output-node-data results/branch_lengths.json             --root Wuhan-Hu-1/2019 Wuhan/WH01/2019             --timetree             --clock-rate 0.0008             --clock-std-dev 0.0004             --coalescent skyline             --date-inference marginal             --divergence-unit mutations             --date-confidence             --no-covariance             --clock-filter-iqd 4
        
[Wed Jun 10 23:48:15 2020]
Error in rule refine:
    jobid: 4
    output: results/tree.nwk, results/branch_lengths.json
    shell:
        
        augur refine             --tree results/tree_raw.nwk             --alignment results/masked.fasta             --metadata results/metadata_adjusted.tsv             --output-tree results/tree.nwk             --output-node-data results/branch_lengths.json             --root Wuhan-Hu-1/2019 Wuhan/WH01/2019             --timetree             --clock-rate 0.0008             --clock-std-dev 0.0004             --coalescent skyline             --date-inference marginal             --divergence-unit mutations             --date-confidence             --no-covariance             --clock-filter-iqd 4
        
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)

Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
Complete log: /nextstrain/build/.snakemake/log/2020-06-10T234401.022011.snakemake.log
